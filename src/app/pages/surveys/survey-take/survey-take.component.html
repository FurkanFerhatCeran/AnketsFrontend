<!-- src/app/pages/surveys/survey-take/survey-take.component.html -->
<div class="survey-viewer">
  <div class="survey-header">
    <h1>{{ survey.title }}</h1>
    <p *ngIf="survey.description" class="survey-description">
      {{ survey.description }}
    </p>
    <div class="survey-meta">
      <span class="question-count" *ngIf="survey.questions">{{ survey.questions.length }} soru</span>
      <span class="required-note" *ngIf="hasRequiredQuestions()">
        * ile işaretli sorular zorunludur
      </span>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Anket yükleniyor...</p>
  </div>

  <form class="survey-form" (ngSubmit)="onSubmit()" #surveyForm="ngForm" *ngIf="!isLoading">
    <div class="questions-container">
      <div
        *ngFor="let question of survey.questions; let i = index"
        class="question-card"
        [class.has-error]="hasError(question.questionId)">
        
        <div class="question-header">
          <h3 class="question-title">
            <span class="question-number">{{ i + 1 }}.</span>
            {{ question.questionTitle }}
            <span class="required-mark" *ngIf="question.isRequired">*</span>
          </h3>
          <p *ngIf="question.questionDescription" class="question-description">
            {{ question.questionDescription }}
          </p>
        </div>

        <div class="question-input">
          <ng-container [ngSwitch]="question.questionTypeId">
            
            <!-- Kısa Metin (1) -->
            <div *ngSwitchCase="1" class="input-group">
              <input
                type="text"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                [placeholder]="question.isRequired ? 'Bu alan zorunludur...' : 'Cevabınızı yazın...'">
            </div>

            <!-- Uzun Metin (2) -->
            <div *ngSwitchCase="2" class="input-group">
              <textarea
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                rows="4"
                [placeholder]="question.isRequired ? 'Bu alan zorunludur...' : 'Cevabınızı yazın...'"></textarea>
            </div>

            <!-- Tekil Seçim - Radio (3) -->
            <div *ngSwitchCase="3" class="radio-group">
              <div *ngFor="let option of question.options" class="radio-option">
                <label class="radio-label">
                  <input
                    type="radio"
                    [(ngModel)]="answers[question.questionId]"
                    [name]="'question-' + question.questionId"
                    [value]="option.optionValue"
                    [required]="question.isRequired">
                  <span class="radio-checkmark"></span>
                  <span class="radio-text">{{ option.optionText }}</span>
                </label>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                Lütfen bir seçenek seçin
              </div>
            </div>

            <!-- Çoklu Seçim - Checkbox (4) -->
            <div *ngSwitchCase="4" class="checkbox-group">
              <div *ngFor="let option of question.options" class="checkbox-option">
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    [checked]="isChecked(question.questionId, option.optionValue)"
                    (change)="onCheckboxChange(question.questionId, option.optionValue, $event)"
                    [name]="'question-' + question.questionId + '-option-' + option.optionValue">
                  <span class="checkbox-checkmark"></span>
                  <span class="checkbox-text">{{ option.optionText }}</span>
                </label>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                Lütfen en az bir seçenek seçin
              </div>
            </div>

            <!-- Dropdown (5) -->
            <div *ngSwitchCase="5" class="input-group">
              <select
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control">
                <option value="">Seçiniz...</option>
                <option *ngFor="let option of question.options" [value]="option.optionValue">
                  {{ option.optionText }}
                </option>
              </select>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                Lütfen bir seçenek seçin
              </div>
            </div>

            <!-- Sayı (6) -->
            <div *ngSwitchCase="6" class="input-group">
              <input
                type="number"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                [placeholder]="question.isRequired ? 'Bu alan zorunludur...' : 'Sayı girin...'">
            </div>

            <!-- Tarih (7) -->
            <div *ngSwitchCase="7" class="input-group">
              <input
                type="date"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control">
            </div>

            <!-- Saat (8) -->
            <div *ngSwitchCase="8" class="input-group">
              <input
                type="time"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control">
            </div>

            <!-- Rating (9) -->
            <div *ngSwitchCase="9" class="rating-group">
              <div class="rating-scale">
                <label
                  *ngFor="let rating of [1,2,3,4,5]; let rIndex = index"
                  class="rating-label"
                  [class.selected]="answers[question.questionId] === (rIndex + 1)">
                  <input
                    type="radio"
                    [name]="'question-' + question.questionId"
                    [value]="rIndex + 1"
                    [required]="question.isRequired"
                    [(ngModel)]="answers[question.questionId]"
                    hidden>
                  <span class="rating-button">{{ rIndex + 1 }}</span>
                </label>
              </div>
              <div class="rating-labels">
                <span class="rating-min">1 (Kötü)</span>
                <span class="rating-max">5 (Mükemmel)</span>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                Lütfen bir puan verin
              </div>
            </div>

            <!-- Scale (10) -->
            <div *ngSwitchCase="10" class="scale-group">
              <div class="input-group">
                <input
                  type="range"
                  [(ngModel)]="answers[question.questionId]"
                  [name]="'question-' + question.questionId"
                  [required]="question.isRequired"
                  min="1"
                  max="10"
                  class="form-control"
                  (input)="onScaleChange(question.questionId, $event)">
              </div>
              <div class="scale-value">
                Seçilen değer: <strong>{{ answers[question.questionId] || 5 }}</strong>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                Lütfen bir değer seçin
              </div>
            </div>

            <!-- Email (11) -->
            <div *ngSwitchCase="11" class="input-group">
              <input
                type="email"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                placeholder="email@example.com"
                pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}">
            </div>

            <!-- Telefon (12) -->
            <div *ngSwitchCase="12" class="input-group">
              <input
                type="tel"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                placeholder="05XX XXX XX XX"
                pattern="[0-9]{10,11}">
            </div>

            <!-- Dosya Yükleme (13) -->
            <div *ngSwitchCase="13" class="file-upload-group">
              <div class="input-group">
                <label class="file-label">
                  <input
                    type="file"
                    (change)="onFileChange(question.questionId, $event)"
                    [name]="'question-' + question.questionId"
                    [required]="question.isRequired"
                    class="file-input"
                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                  <span class="file-button">Dosya Seç</span>
                  <span class="file-name">{{ getFileName(question.questionId) || 'Dosya seçilmedi' }}</span>
                </label>
              </div>
              <div class="file-hint">
                Desteklenen formatlar: PDF, DOC, DOCX, JPG, JPEG, PNG
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                Lütfen bir dosya yükleyin
              </div>
            </div>

            <!-- Bilgi Mesajı (14) -->
            <div *ngSwitchCase="14" class="info-message">
              <div class="info-icon">ℹ️</div>
              <div class="info-content">
                <h4>Bilgilendirme</h4>
                <p>{{ question.questionDescription || 'Bu bir bilgilendirme mesajıdır.' }}</p>
              </div>
            </div>

            <!-- Başlık (15) -->
            <div *ngSwitchCase="15" class="title-message">
              <h4>{{ question.questionTitle }}</h4>
              <p *ngIf="question.questionDescription">{{ question.questionDescription }}</p>
            </div>

          </ng-container>
        </div>

        <div class="error-message" *ngIf="hasError(question.questionId) && question.isRequired">
          ⚠️ Bu soru zorunludur
        </div>
      </div>
    </div>

    <div class="form-footer">
      <div class="respondent-info">
        <label class="respondent-label">
          <span class="label-text">İsim (opsiyonel)</span>
          <input
            type="text"
            [(ngModel)]="respondentName"
            name="respondentName"
            placeholder="Adınızı girin..."
            class="form-control">
        </label>
      </div>
      
      <div class="submit-section">
        <button class="btn-secondary" type="button" (click)="onBack()">
          ← Geri Dön
        </button>
        <button
          class="btn-primary"
          type="submit"
          [disabled]="submitting">
          <span class="btn-content">
            <span *ngIf="submitting" class="loading-spinner"></span>
            {{ submitting ? 'Gönderiliyor...' : '✅ Anketi Gönder' }}
          </span>
        </button>
      </div>
    </div>
  </form>
</div>