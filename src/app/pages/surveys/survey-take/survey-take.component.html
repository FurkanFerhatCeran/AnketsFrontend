<!-- src/app/pages/surveys/survey-take/survey-take.component.html -->
<div class="survey-viewer">
  <!-- Debug bilgisi kaldƒ±rƒ±ldƒ± -->

  <!-- √ñnizleme modunda header -->
  <div class="survey-header" *ngIf="isPreviewMode">
    <div class="preview-header-content">
      <div class="header-text">
        <h1 class="main-title">
          <span class="title-icon">üëÅÔ∏è</span>
          Anket √ñnizlemesi
        </h1>
        <p class="subtitle">Anketinizin nasƒ±l g√∂r√ºneceƒüini kontrol edin</p>
      </div>
      
      <div class="header-actions">
        <button class="btn-secondary" (click)="onBack()">
          <span class="btn-icon">‚Üê</span>
          Geri D√∂n
        </button>
        
        <button class="btn-edit" (click)="navigateToEdit()">
          <span class="btn-icon">‚úèÔ∏è</span>
          D√ºzenle
        </button>
        
        <button class="btn-take" (click)="navigateToTake()">
          <span class="btn-icon">üìù</span>
          Anketi Doldur
        </button>
      </div>
    </div>
  </div>

  <!-- Normal anket header -->
  <div class="survey-header" *ngIf="!isPreviewMode">
    <h1>{{ survey.title }}</h1>
    <p *ngIf="survey.description" class="survey-description">
      {{ survey.description }}
    </p>
    <div class="survey-meta">
      <span class="question-count" *ngIf="survey.questions">{{ survey.questions.length }} soru</span>
      <span class="required-note" *ngIf="hasRequiredQuestions()">
        * ile i≈üaretli sorular zorunludur
      </span>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Anket y√ºkleniyor...</p>
  </div>

  <!-- √ñnizleme modunda form olmadan g√∂ster -->
  <div class="questions-container" *ngIf="!isLoading && isPreviewMode && survey.questions && survey.questions.length > 0">
    <div
      *ngFor="let question of survey.questions; let i = index"
      class="question-card">
      
      <div class="question-header">
        <h3 class="question-title">
          <span class="question-number">{{ i + 1 }}.</span>
          {{ question.questionTitle }}
          <span class="required-mark" *ngIf="question.isRequired">*</span>
        </h3>
        <p *ngIf="question.questionDescription" class="question-description">
          {{ question.questionDescription }}
        </p>
      </div>

      <div class="question-preview">
        <ng-container [ngSwitch]="question.questionTypeId">
          
          <!-- Kƒ±sa Metin (1) -->
          <div *ngSwitchCase="1" class="preview-input">
            <input type="text" placeholder="Cevap √∂rneƒüi..." disabled>
          </div>

          <!-- Uzun Metin (2) -->
          <div *ngSwitchCase="2" class="preview-input">
            <textarea placeholder="Uzun cevap √∂rneƒüi..." rows="3" disabled></textarea>
          </div>

          <!-- Tekil Se√ßim - Radio (3) -->
          <div *ngSwitchCase="3" class="preview-options">
            <div *ngFor="let option of question.options" class="preview-option">
              <label class="preview-radio">
                <input type="radio" disabled>
                <span class="radio-text">{{ option.optionText }}</span>
              </label>
            </div>
          </div>

          <!-- √áoklu Se√ßim - Checkbox (4) -->
          <div *ngSwitchCase="4" class="preview-options">
            <div *ngFor="let option of question.options" class="preview-option">
              <label class="preview-checkbox">
                <input type="checkbox" disabled>
                <span class="checkbox-text">{{ option.optionText }}</span>
              </label>
            </div>
          </div>

          <!-- Dropdown (5) -->
          <div *ngSwitchCase="5" class="preview-input">
            <select disabled>
              <option>Se√ßiniz...</option>
              <option *ngFor="let option of question.options" [value]="option.optionValue">
                {{ option.optionText }}
              </option>
            </select>
          </div>

          <!-- Sayƒ± (6) -->
          <div *ngSwitchCase="6" class="preview-input">
            <input type="number" placeholder="0" disabled>
          </div>

          <!-- Tarih (7) -->
          <div *ngSwitchCase="7" class="preview-input">
            <input type="date" disabled>
          </div>

          <!-- Saat (8) -->
          <div *ngSwitchCase="8" class="preview-input">
            <input type="time" disabled>
          </div>

          <!-- Rating (9) -->
          <div *ngSwitchCase="9" class="preview-rating">
            <div class="rating-scale">
              <span *ngFor="let rating of [1,2,3,4,5]" class="rating-star">‚≠ê</span>
            </div>
            <div class="rating-labels">
              <span>1 (K√∂t√º)</span>
              <span>5 (M√ºkemmel)</span>
            </div>
          </div>

          <!-- Scale (10) -->
          <div *ngSwitchCase="10" class="preview-scale">
            <input type="range" min="1" max="10" value="5" disabled>
            <div class="scale-value">Se√ßilen deƒüer: 5</div>
          </div>

          <!-- Email (11) -->
          <div *ngSwitchCase="11" class="preview-input">
            <input type="email" placeholder="email@example.com" disabled>
          </div>

          <!-- Telefon (12) -->
          <div *ngSwitchCase="12" class="preview-input">
            <input type="tel" placeholder="05XX XXX XX XX" disabled>
          </div>

          <!-- Dosya Y√ºkleme (13) -->
          <div *ngSwitchCase="13" class="preview-file">
            <div class="file-upload-preview">
              <span class="file-icon">üìé</span>
              <span class="file-text">Dosya se√ßin</span>
            </div>
            <div class="file-hint">PDF, DOC, DOCX, JPG, PNG (max 5MB)</div>
          </div>

          <!-- Bilgi Mesajƒ± (14) -->
          <div *ngSwitchCase="14" class="preview-info">
            <div class="info-icon">‚ÑπÔ∏è</div>
            <div class="info-content">
              <h4>Bilgilendirme</h4>
              <p>{{ question.questionDescription || 'Bu bir bilgilendirme mesajƒ±dƒ±r.' }}</p>
            </div>
          </div>

          <!-- Ba≈ülƒ±k (15) -->
          <div *ngSwitchCase="15" class="preview-title">
            <h4>{{ question.questionTitle }}</h4>
            <p *ngIf="question.questionDescription">{{ question.questionDescription }}</p>
          </div>

        </ng-container>
      </div>
    </div>
  </div>

  <!-- Soru bulunamadƒ±ƒüƒ±nda mesaj -->
  <div *ngIf="!isLoading && isPreviewMode && (!survey.questions || survey.questions.length === 0)" class="no-questions">
    <div class="no-questions-content">
      <span class="no-questions-icon">‚ùì</span>
      <h3>Hen√ºz soru eklenmemi≈ü</h3>
      <p>Bu ankette hen√ºz soru bulunmuyor. D√ºzenle butonuna tƒ±klayarak soru ekleyebilirsiniz.</p>
    </div>
  </div>

  <!-- Normal form (√∂nizleme modunda deƒüil) -->
  <form class="survey-form" (ngSubmit)="onSubmit()" #surveyForm="ngForm" *ngIf="!isLoading && !isPreviewMode">
    <div class="questions-container">
      <div
        *ngFor="let question of survey.questions; let i = index"
        class="question-card"
        [class.has-error]="hasError(question.questionId)">
        
        <div class="question-header">
          <h3 class="question-title">
            <span class="question-number">{{ i + 1 }}.</span>
            {{ question.questionTitle }}
            <span class="required-mark" *ngIf="question.isRequired">*</span>
          </h3>
          <p *ngIf="question.questionDescription" class="question-description">
            {{ question.questionDescription }}
          </p>
        </div>

        <div class="question-input">
          <ng-container [ngSwitch]="question.questionTypeId">
            
            <!-- Kƒ±sa Metin (1) -->
            <div *ngSwitchCase="1" class="input-group">
              <input
                type="text"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                [placeholder]="question.isRequired ? 'Bu alan zorunludur...' : 'Cevabƒ±nƒ±zƒ± yazƒ±n...'">
            </div>

            <!-- Uzun Metin (2) -->
            <div *ngSwitchCase="2" class="input-group">
              <textarea
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                rows="4"
                [placeholder]="question.isRequired ? 'Bu alan zorunludur...' : 'Cevabƒ±nƒ±zƒ± yazƒ±n...'"></textarea>
            </div>

            <!-- Tekil Se√ßim - Radio (3) -->
            <div *ngSwitchCase="3" class="radio-group">
              <div *ngFor="let option of question.options" class="radio-option">
                <label class="radio-label">
                  <input
                    type="radio"
                    [(ngModel)]="answers[question.questionId]"
                    [name]="'question-' + question.questionId"
                    [value]="option.optionValue"
                    [required]="question.isRequired">
                  <span class="radio-checkmark"></span>
                  <span class="radio-text">{{ option.optionText }}</span>
                </label>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                L√ºtfen bir se√ßenek se√ßin
              </div>
            </div>

            <!-- √áoklu Se√ßim - Checkbox (4) -->
            <div *ngSwitchCase="4" class="checkbox-group">
              <div *ngFor="let option of question.options" class="checkbox-option">
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    [checked]="isChecked(question.questionId, option.optionValue)"
                    (change)="onCheckboxChange(question.questionId, option.optionValue, $event)"
                    [name]="'question-' + question.questionId + '-option-' + option.optionValue">
                  <span class="checkbox-checkmark"></span>
                  <span class="checkbox-text">{{ option.optionText }}</span>
                </label>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                L√ºtfen en az bir se√ßenek se√ßin
              </div>
            </div>

            <!-- Dropdown (5) -->
            <div *ngSwitchCase="5" class="input-group">
              <select
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control">
                <option value="">Se√ßiniz...</option>
                <option *ngFor="let option of question.options" [value]="option.optionValue">
                  {{ option.optionText }}
                </option>
              </select>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                L√ºtfen bir se√ßenek se√ßin
              </div>
            </div>

            <!-- Sayƒ± (6) -->
            <div *ngSwitchCase="6" class="input-group">
              <input
                type="number"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                [placeholder]="question.isRequired ? 'Bu alan zorunludur...' : 'Sayƒ± girin...'">
            </div>

            <!-- Tarih (7) -->
            <div *ngSwitchCase="7" class="input-group">
              <input
                type="date"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control">
            </div>

            <!-- Saat (8) -->
            <div *ngSwitchCase="8" class="input-group">
              <input
                type="time"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control">
            </div>

            <!-- Rating (9) -->
            <div *ngSwitchCase="9" class="rating-group">
              <div class="rating-scale">
                <label
                  *ngFor="let rating of [1,2,3,4,5]; let rIndex = index"
                  class="rating-label"
                  [class.selected]="answers[question.questionId] === (rIndex + 1)">
                  <input
                    type="radio"
                    [name]="'question-' + question.questionId"
                    [value]="rIndex + 1"
                    [required]="question.isRequired"
                    [(ngModel)]="answers[question.questionId]"
                    hidden>
                  <span class="rating-button">{{ rIndex + 1 }}</span>
                </label>
              </div>
              <div class="rating-labels">
                <span class="rating-min">1 (K√∂t√º)</span>
                <span class="rating-max">5 (M√ºkemmel)</span>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                L√ºtfen bir puan verin
              </div>
            </div>

            <!-- Scale (10) -->
            <div *ngSwitchCase="10" class="scale-group">
              <div class="input-group">
                <input
                  type="range"
                  [(ngModel)]="answers[question.questionId]"
                  [name]="'question-' + question.questionId"
                  [required]="question.isRequired"
                  min="1"
                  max="10"
                  class="form-control"
                  (input)="onScaleChange(question.questionId, $event)">
              </div>
              <div class="scale-value">
                Se√ßilen deƒüer: <strong>{{ answers[question.questionId] || 5 }}</strong>
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                L√ºtfen bir deƒüer se√ßin
              </div>
            </div>

            <!-- Email (11) -->
            <div *ngSwitchCase="11" class="input-group">
              <input
                type="email"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                placeholder="email@example.com"
                pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}">
            </div>

            <!-- Telefon (12) -->
            <div *ngSwitchCase="12" class="input-group">
              <input
                type="tel"
                [(ngModel)]="answers[question.questionId]"
                [name]="'question-' + question.questionId"
                [required]="question.isRequired"
                class="form-control"
                placeholder="05XX XXX XX XX"
                pattern="[0-9]{10,11}">
            </div>

            <!-- Dosya Y√ºkleme (13) -->
            <div *ngSwitchCase="13" class="file-upload-group">
              <div class="input-group">
                <label class="file-label">
                  <input
                    type="file"
                    (change)="onFileChange(question.questionId, $event)"
                    [name]="'question-' + question.questionId"
                    [required]="question.isRequired"
                    class="file-input"
                    accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                  <span class="file-button">Dosya Se√ß</span>
                  <span class="file-name">{{ getFileName(question.questionId) || 'Dosya se√ßilmedi' }}</span>
                </label>
              </div>
              <div class="file-hint">
                Desteklenen formatlar: PDF, DOC, DOCX, JPG, JPEG, PNG
              </div>
              <div class="error-hint" *ngIf="hasError(question.questionId) && question.isRequired">
                L√ºtfen bir dosya y√ºkleyin
              </div>
            </div>

            <!-- Bilgi Mesajƒ± (14) -->
            <div *ngSwitchCase="14" class="info-message">
              <div class="info-icon">‚ÑπÔ∏è</div>
              <div class="info-content">
                <h4>Bilgilendirme</h4>
                <p>{{ question.questionDescription || 'Bu bir bilgilendirme mesajƒ±dƒ±r.' }}</p>
              </div>
            </div>

            <!-- Ba≈ülƒ±k (15) -->
            <div *ngSwitchCase="15" class="title-message">
              <h4>{{ question.questionTitle }}</h4>
              <p *ngIf="question.questionDescription">{{ question.questionDescription }}</p>
            </div>

          </ng-container>
        </div>

        <div class="error-message" *ngIf="hasError(question.questionId) && question.isRequired">
          ‚ö†Ô∏è Bu soru zorunludur
        </div>
      </div>
    </div>

    <div class="form-footer">
      <div class="respondent-info">
        <label class="respondent-label">
          <span class="label-text">ƒ∞sim (opsiyonel)</span>
          <input
            type="text"
            [(ngModel)]="respondentName"
            name="respondentName"
            placeholder="Adƒ±nƒ±zƒ± girin..."
            class="form-control">
        </label>
      </div>
      
      <div class="submit-section">
        <button class="btn-secondary" type="button" (click)="onBack()">
          ‚Üê Geri D√∂n
        </button>
        <button
          class="btn-primary"
          type="submit"
          [disabled]="submitting">
          <span class="btn-content">
            <span *ngIf="submitting" class="loading-spinner"></span>
            {{ submitting ? 'G√∂nderiliyor...' : '‚úÖ Anketi G√∂nder' }}
          </span>
        </button>
      </div>
    </div>
  </form>
</div>