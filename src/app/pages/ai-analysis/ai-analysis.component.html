<div class="ai-analysis-container">
  <h2 class="title">📊 Yapay Zeka Anket Analizi</h2>
  <p class="description">
    Anket verilerinizi yapay zeka ile analiz edin, içgörü kazanın ve detaylı raporlar alın.
  </p>

  <!-- Anket Seçimi -->
  <div class="survey-selection">
    <mat-form-field appearance="outline" class="survey-select">
      <mat-label>Analiz için anket seçin</mat-label>
      <mat-select [(ngModel)]="selectedSurveyId" (selectionChange)="onSelectSurvey($event.value)">
        <mat-option *ngFor="let survey of surveys" [value]="survey.surveyId">
          {{ survey.title }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-spinner">
    <mat-progress-spinner mode="indeterminate" diameter="60"></mat-progress-spinner>
    <p>Analiz oluşturuluyor, lütfen bekleyin...</p>
  </div>

  <!-- Hata Mesajı -->
  <mat-card *ngIf="errorMessage" class="error-card">
    <mat-icon color="warn">error_outline</mat-icon>
    <span>{{ errorMessage }}</span>
  </mat-card>

  <!-- Analiz Sonucu -->
  <div *ngIf="parsedAnalysis" class="analysis-results">
    
    <!-- Analiz Başlığı ve Meta Bilgiler -->
    <mat-card class="header-card">
      <div class="analysis-header">
        <h3>📑 {{ parsedAnalysis.metadata.surveyTitle }}</h3>
        <div class="metadata">
          <span class="generated-date">📅 {{ parsedAnalysis.metadata.generatedAt }}</span>
          <span class="confidence-level">🎯 Güven Seviyesi: {{ parsedAnalysis.metadata.confidenceLevel * 100 | number:'1.0-0' }}%</span>
        </div>
      </div>
    </mat-card>

    <!-- Özet -->
    <mat-card class="summary-card">
      <div class="card-header">
        <h4>📋 Analiz Özeti</h4>
      </div>
      <div class="card-content">
        <p class="summary-text">{{ parsedAnalysis.summary }}</p>
      </div>
    </mat-card>

    <!-- İçgörüler -->
    <mat-card class="insights-card" *ngIf="parsedAnalysis.insights.length > 0">
      <div class="card-header">
        <h4>💡 Önemli İçgörüler</h4>
      </div>
      <div class="card-content">
        <ul class="insights-list">
          <li *ngFor="let insight of parsedAnalysis.insights" class="insight-item">
            {{ insight }}
          </li>
        </ul>
      </div>
    </mat-card>

    <!-- Öneriler -->
    <mat-card class="recommendations-card" *ngIf="parsedAnalysis.recommendations.length > 0">
      <div class="card-header">
        <h4>🎯 Öneriler</h4>
      </div>
      <div class="card-content">
        <ul class="recommendations-list">
          <li *ngFor="let recommendation of parsedAnalysis.recommendations" class="recommendation-item">
            {{ recommendation }}
          </li>
        </ul>
      </div>
    </mat-card>

  </div>
</div>
